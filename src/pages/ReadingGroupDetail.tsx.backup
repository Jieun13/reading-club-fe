import React, { useState, useEffect } from 'react';
import { useParams, useNavigate, Link } from 'react-router-dom';
import { 
  UserGroupIcon, 
  ArrowLeftIcon, 
  ShareIcon, 
  CogIcon,
  UserPlusIcon,
  BookOpenIcon,
  CalendarIcon,
  ChatBubbleLeftRightIcon,
  ClockIcon,
  PlusIcon,
  TrashIcon,
  StarIcon
} from '@heroicons/react/24/outline';
import { StarIcon as StarIconSolid } from '@heroicons/react/24/solid';
import { readingGroupApi } from '../api/readingGroups';
import { wishlistApi } from '../api/wishlists';
import { ReadingGroup } from '../types/readingGroup';
import { useAuth } from '../contexts/AuthContext';
import Loading from '../components/common/Loading';

const ReadingGroupDetail: React.FC = () => {
  const { groupId } = useParams<{ groupId: string }>();
  const navigate = useNavigate();
  const { user } = useAuth();
  const [group, setGroup] = useState<ReadingGroup | null>(null);
  const [loading, setLoading] = useState(true);
  const [showInviteCode, setShowInviteCode] = useState(false);

  useEffect(() => {
    const fetchGroupData = async () => {
      if (groupId) {
        try {
          setLoading(true);
          const response = await readingGroupApi.getGroup(Number(groupId));
          setGroup(response.data.data);
        } catch (error) {
          console.error('ë…ì„œ ëª¨ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
          alert('ë…ì„œ ëª¨ì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          navigate('/reading-groups');
        } finally {
          setLoading(false);
        }
      }
    };

    fetchGroupData();
  }, [groupId, navigate]);

  const handleCopyInviteCode = () => {
    if (group) {
      const inviteUrl = `${window.location.origin}/reading-groups/join/${group.inviteCode}`;
      navigator.clipboard.writeText(inviteUrl);
      alert('ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  };

  const handleAddToWishlist = async () => {
    if (!group || !group.bookTitle) {
      return;
    }

    try {
      // ì¤‘ë³µ ì²´í¬
      const duplicateCheck = await wishlistApi.checkDuplicate(
        group.bookTitle,
        group.bookAuthor || undefined
      );

      if (duplicateCheck.data.data.duplicate) {
        alert('ì´ë¯¸ ì½ê³  ì‹¶ì€ ì±…ì— ì¶”ê°€ëœ ì±…ì…ë‹ˆë‹¤.');
        return;
      }

      const wishlistData = {
        title: group.bookTitle,
        author: group.bookAuthor || '',
        publisher: group.bookPublisher || '',
        coverImage: group.bookCoverImage || '',
        memo: `${group.name} ëª¨ì„ì˜ ì´ë‹¬ì˜ ì±…`
      };

      await wishlistApi.addWishlist(wishlistData);
      alert('ì½ê³  ì‹¶ì€ ì±…ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } catch (error) {
      console.error('ì½ê³  ì‹¶ì€ ì±… ì¶”ê°€ ì‹¤íŒ¨:', error);
      alert('ì½ê³  ì‹¶ì€ ì±… ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
  };

  const handleRegenerateInviteCode = async () => {
    if (!group || !window.confirm('ì´ˆëŒ€ ì½”ë“œë¥¼ ì¬ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ì¡´ ë§í¬ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.')) {
      return;
    }

    try {
      const response = await readingGroupApi.regenerateInviteCode(group.id);
      setGroup(prev => prev ? { ...prev, inviteCode: response.data.data.inviteCode } : null);
      alert('ì´ˆëŒ€ ì½”ë“œê°€ ì¬ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      console.error('ì´ˆëŒ€ ì½”ë“œ ì¬ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
      alert('ì´ˆëŒ€ ì½”ë“œ ì¬ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleLeaveGroup = async () => {
    if (!group || !window.confirm('ì •ë§ë¡œ ì´ ëª¨ì„ì—ì„œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      return;
    }

    try {
      await readingGroupApi.leaveGroup(group.id);
      alert('ëª¨ì„ì—ì„œ íƒˆí‡´í–ˆìŠµë‹ˆë‹¤.');
      navigate('/reading-groups');
    } catch (error) {
      console.error('ëª¨ì„ íƒˆí‡´ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
      alert('ëª¨ì„ íƒˆí‡´ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  if (loading) {
    return (
      <div className="container py-8">
        <div className="text-center">
          <Loading size="lg" text="ë…ì„œ ëª¨ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." />
        </div>
      </div>
    );
  }

  if (!group) {
    return (
      <div className="container py-8">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-gray-900">ëª¨ì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
        </div>
      </div>
    );
  }

  const isCreator = user && group && group.creator.id === user.id;

  const handleDeleteGroup = async () => {
    if (!group || !window.confirm('ì •ë§ë¡œ ì´ ëª¨ì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œëœ ëª¨ì„ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      return;
    }

    try {
      await readingGroupApi.deleteGroup(group.id);
      alert('ëª¨ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      navigate('/reading-groups');
    } catch (error) {
      console.error('ëª¨ì„ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('ëª¨ì„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
  };

  const fetchReviews = async (groupId: number) => {
    try {
      const response = await groupReviewApi.getGroupReviews(groupId);
      setReviews(response.data.data || []);
    } catch (error) {
      console.error('ë¦¬ë·° ì¡°íšŒ ì‹¤íŒ¨:', error);
      setReviews([]);
    }
  };

  const handleSubmitReview = async () => {
    if (!group || !reviewForm.title.trim() || !reviewForm.content.trim()) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    try {
      const reviewData: GroupReviewCreateRequest = {
        readingGroupId: group.id,
        rating: reviewForm.rating,
        title: reviewForm.title,
        content: reviewForm.content,
        favoriteQuote: reviewForm.favoriteQuote || undefined,
        recommendation: reviewForm.recommendation || undefined,
        isPublic: reviewForm.isPublic
      };

      await groupReviewApi.createReview(reviewData);
      alert('ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setShowReviewForm(false);
      setReviewForm({
        rating: 5,
        title: '',
        content: '',
        favoriteQuote: '',
        recommendation: '',
        isPublic: true
      });
      fetchReviews(group.id); // ë¦¬ë·° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    } catch (error) {
      console.error('ë¦¬ë·° ì‘ì„± ì‹¤íŒ¨:', error);
      alert('ë¦¬ë·° ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
  };

  const renderStars = (rating: number, interactive: boolean = false, onRatingChange?: (rating: number) => void) => {
    return (
      <div className="flex items-center space-x-1">
        {[1, 2, 3, 4, 5].map((star) => (
          <button
            key={star}
            type="button"
            onClick={() => interactive && onRatingChange && onRatingChange(star)}
            className={`${interactive ? 'cursor-pointer hover:scale-110' : 'cursor-default'} transition-transform`}
            disabled={!interactive}
          >
            {star <= rating ? (
              <StarIconSolid className="w-5 h-5 text-yellow-400" />
            ) : (
              <StarIcon className="w-5 h-5 text-gray-300" />
            )}
          </button>
        ))}
      </div>
    );
  };

  return (
    <div className="container py-8">
      <div className="max-w-4xl mx-auto">
        {/* í—¤ë” */}
        <div className="flex items-center justify-between mb-8">
          <div className="flex items-center">
            <button
              onClick={() => navigate('/reading-groups')}
              className="mr-4 p-2 text-gray-600 hover:text-gray-900 rounded-md hover:bg-gray-100"
            >
              <ArrowLeftIcon className="w-5 h-5" />
            </button>
            <h1 className="text-3xl font-bold text-gray-900 flex items-center">
              <UserGroupIcon className="w-8 h-8 text-primary-600 mr-3" />
              {group.name}
            </h1>
          </div>
          
          <div className="flex items-center space-x-2">
            <button
              onClick={() => setShowInviteCode(!showInviteCode)}
              className="btn btn-outline flex items-center"
            >
              <ShareIcon className="w-4 h-4 mr-2" />
              ì´ˆëŒ€í•˜ê¸°
            </button>
          </div>
        </div>

        {/* ì´ˆëŒ€ ì½”ë“œ ì„¹ì…˜ */}
        {showInviteCode && (
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
            <h3 className="text-lg font-medium text-blue-900 mb-3">ëª¨ì„ ì´ˆëŒ€</h3>
            <div className="space-y-3">
              <div>
                <label className="block text-sm font-medium text-blue-800 mb-1">
                  ì´ˆëŒ€ ë§í¬
                </label>
                <div className="flex">
                  <input
                    type="text"
                    value={`${window.location.origin}/reading-groups/join/${group.inviteCode}`}
                    readOnly
                    className="flex-1 px-3 py-2 bg-white border border-blue-300 rounded-l-md text-sm"
                  />
                  <button
                    onClick={handleCopyInviteCode}
                    className="px-4 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700 text-sm"
                  >
                    ë³µì‚¬
                  </button>
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-blue-800 mb-1">
                  ì´ˆëŒ€ ì½”ë“œ
                </label>
                <div className="flex items-center space-x-2">
                  <code className="px-3 py-2 bg-white border border-blue-300 rounded text-lg font-mono">
                    {group.inviteCode}
                  </code>
                  {isCreator && (
                    <button
                      onClick={handleRegenerateInviteCode}
                      className="text-sm text-blue-600 hover:text-blue-800"
                    >
                      ì¬ìƒì„±
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        )}

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* ë©”ì¸ ì½˜í…ì¸  */}
          <div className="lg:col-span-2 space-y-6">
            {/* ëª¨ì„ ì •ë³´ */}
            <div className="bg-white rounded-lg shadow p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-4">ëª¨ì„ ì •ë³´</h2>

              <div className="space-y-4">
                <div>
                  <dt className="text-sm font-medium text-gray-500">ëª¨ì„ ì„¤ëª…</dt>
                  <dd className="mt-1 text-sm text-gray-900">
                    {group.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}
                  </dd>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <dt className="text-sm font-medium text-gray-500">ë©¤ë²„ ìˆ˜</dt>
                    <dd className="mt-1 text-sm text-gray-900">
                      {group.currentMemberCount}/{group.maxMembers}ëª…
                    </dd>
                  </div>
                  <div>
                    <dt className="text-sm font-medium text-gray-500">ê³µê°œ ì„¤ì •</dt>
                    <dd className="mt-1">
          <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
              group.isPublic
                  ? 'text-green-600 bg-green-50 border border-green-200'
                  : 'text-gray-600 bg-gray-50 border border-gray-200'
          }`}>
            {group.isPublic ? 'ê³µê°œ' : 'ë¹„ê³µê°œ'}
          </span>
                    </dd>
                  </div>
                </div>

                {/* âœ… ê³¼ì œ ìœ ë¬´ ì¶”ê°€ */}
                <div>
                  <dt className="text-sm font-medium text-gray-500">ê³¼ì œ</dt>
                  <dd className="mt-1 text-sm text-gray-900">
                    {group.hasAssignment ? 'ëª¨ì„ ì „ê¹Œì§€ ì±… ì½ê³  ë¦¬ë·° ë‚¨ê¸°ê¸°' : 'ê³¼ì œ ì—†ìŒ'}
                  </dd>
                </div>
              </div>
            </div>


            {/* ì´ë‹¬ì˜ ì±… */}
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold text-gray-900 flex items-center">
                  <BookOpenIcon className="w-5 h-5 mr-2" />
                  ì´ë‹¬ì˜ ì±…
                </h2>
              </div>

              {group.bookTitle ? (
                  <div className="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg">
                    <div className="w-16 h-20 flex-shrink-0">
                      {group.bookCoverImage ? (
                          <img
                              src={group.bookCoverImage}
                              alt={group.bookTitle}
                              className="w-full h-full object-cover rounded"
                              onError={(e) => {
                                e.currentTarget.style.display = 'none';
                                const fallback = e.currentTarget.parentElement?.querySelector('.fallback-image') as HTMLElement;
                                if (fallback) fallback.style.display = 'flex';
                              }}
                          />
                      ) : (
                          <div className="fallback-image w-full h-full bg-gray-200 rounded flex items-center justify-center">
                            <BookOpenIcon className="w-8 h-8 text-gray-400" />
                          </div>
                      )}
                    </div>
                    <div className="flex-1">
                      <h3 className="font-semibold text-gray-900 mb-1">{group.bookTitle}</h3>
                      <p className="text-gray-600 text-sm mb-2">{group.bookAuthor}</p>
                      <p className="text-xs text-gray-500 mb-3">{group.bookPublisher}</p>

                      <div className="flex items-center justify-end">
                        
                        {/* ì½ê³  ì‹¶ì€ ì±… ì¶”ê°€ ë²„íŠ¼ */}
                        <button
                          onClick={handleAddToWishlist}
                          className="flex items-center px-3 py-1.5 text-sm bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors"
                        >
                          <PlusIcon className="w-4 h-4 mr-1" />
                          ì½ê³  ì‹¶ì€ ì±… ì¶”ê°€
                        </button>
                      </div>
                    </div>
                  </div>
              ) : (
                  <p className="text-gray-500">ì•„ì§ ì„ ì •ëœ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
              )}
            </div>

            {/* ë¦¬ë·° ì„¹ì…˜ */}
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold text-gray-900 flex items-center">
                  <ChatBubbleLeftRightIcon className="w-5 h-5 mr-2" />
                  ëª¨ì„ ë¦¬ë·°
                </h2>
                <button
                  onClick={() => setShowReviewForm(!showReviewForm)}
                  className="btn btn-primary btn-sm flex items-center"
                >
                  <PlusIcon className="w-4 h-4 mr-1" />
                  ë¦¬ë·° ì‘ì„±
                </button>
              </div>

                {/* ë¦¬ë·° ì‘ì„± í¼ */}
                {showReviewForm && (
                  <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ë³„ì 
                        </label>
                        {renderStars(reviewForm.rating, true, (rating) => 
                          setReviewForm(prev => ({ ...prev, rating }))
                        )}
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ë¦¬ë·° ì œëª© *
                        </label>
                        <input
                          type="text"
                          value={reviewForm.title}
                          onChange={(e) => setReviewForm(prev => ({ ...prev, title: e.target.value }))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
                          placeholder="ë¦¬ë·° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ë¦¬ë·° ë‚´ìš© *
                        </label>
                        <textarea
                          value={reviewForm.content}
                          onChange={(e) => setReviewForm(prev => ({ ...prev, content: e.target.value }))}
                          rows={4}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
                          placeholder="ì±…ì— ëŒ€í•œ ìƒê°ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ì¸ìƒ ê¹Šì€ êµ¬ì ˆ
                        </label>
                        <textarea
                          value={reviewForm.favoriteQuote}
                          onChange={(e) => setReviewForm(prev => ({ ...prev, favoriteQuote: e.target.value }))}
                          rows={2}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
                          placeholder="ê¸°ì–µì— ë‚¨ëŠ” êµ¬ì ˆì´ ìˆë‹¤ë©´ ì ì–´ì£¼ì„¸ìš”"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ì¶”ì²œ ì—¬ë¶€
                        </label>
                        <textarea
                          value={reviewForm.recommendation}
                          onChange={(e) => setReviewForm(prev => ({ ...prev, recommendation: e.target.value }))}
                          rows={2}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
                          placeholder="ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ ì´ ì±…ì„ ì¶”ì²œí•˜ê³  ì‹¶ì€ì§€ ì´ìœ ì™€ í•¨ê»˜ ì ì–´ì£¼ì„¸ìš”"
                        />
                      </div>

                      <div className="flex items-center">
                        <input
                          type="checkbox"
                          id="isPublic"
                          checked={reviewForm.isPublic}
                          onChange={(e) => setReviewForm(prev => ({ ...prev, isPublic: e.target.checked }))}
                          className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                        />
                        <label htmlFor="isPublic" className="ml-2 block text-sm text-gray-700">
                          ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œ ê³µê°œ
                        </label>
                      </div>

                      <div className="flex justify-end space-x-2">
                        <button
                          onClick={() => setShowReviewForm(false)}
                          className="px-4 py-2 text-sm text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200"
                        >
                          ì·¨ì†Œ
                        </button>
                        <button
                          onClick={handleSubmitReview}
                          className="px-4 py-2 text-sm text-white bg-primary-600 rounded-md hover:bg-primary-700"
                        >
                          ë¦¬ë·° ë“±ë¡
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* ë¦¬ë·° ëª©ë¡ */}
                <div className="space-y-4">
                  {reviews.length > 0 ? (
                    reviews.map((review) => (
                      <div key={review.id} className="border border-gray-200 rounded-lg p-4">
                        <div className="flex items-start justify-between mb-2">
                          <div className="flex items-center space-x-3">
                            <div className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                              {review.user.profileImage ? (
                                <img
                                  src={review.user.profileImage}
                                  alt={review.user.nickname}
                                  className="w-8 h-8 rounded-full object-cover"
                                />
                              ) : (
                                <span className="text-sm font-medium text-gray-600">
                                  {review.user.nickname.charAt(0)}
                                </span>
                              )}
                            </div>
                            <div>
                              <p className="font-medium text-gray-900">{review.user.nickname}</p>
                              <div className="flex items-center space-x-2">
                                {renderStars(review.rating)}
                                <span className="text-sm text-gray-500">
                                  {new Date(review.createdAt).toLocaleDateString('ko-KR')}
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <h4 className="font-semibold text-gray-900 mb-2">{review.title}</h4>
                        <p className="text-gray-700 mb-3">{review.content}</p>
                        
                        {review.favoriteQuote && (
                          <div className="bg-gray-50 border-l-4 border-primary-500 p-3 mb-3">
                            <p className="text-sm text-gray-600 italic">"{review.favoriteQuote}"</p>
                          </div>
                        )}
                        
                        {review.recommendation && (
                          <div className="bg-blue-50 p-3 rounded">
                            <p className="text-sm text-blue-800">
                              <strong>ì¶”ì²œ:</strong> {review.recommendation}
                            </p>
                          </div>
                        )}
                      </div>
                    ))
                  ) : (
                    <div className="text-center py-8 text-gray-500">
                      <ChatBubbleLeftRightIcon className="w-12 h-12 mx-auto mb-3 text-gray-300" />
                      <p>ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                      <p className="text-sm">ì²« ë²ˆì§¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>

          {/* ì‚¬ì´ë“œë°” */}
          <div className="space-y-6">
            {/* ëª¨ì„ì¥ ì •ë³´ */}
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">ëª¨ì„ì¥</h3>
              <div className="flex items-center">
                {group.creator.profileImage ? (
                  <img
                    src={group.creator.profileImage}
                    alt={group.creator.nickname}
                    className="w-10 h-10 rounded-full mr-3"
                  />
                ) : (
                  <div className="w-10 h-10 bg-gray-300 rounded-full mr-3 flex items-center justify-center">
                    <UserGroupIcon className="w-5 h-5 text-gray-600" />
                  </div>
                )}
                  <div className="font-medium text-gray-900">{group.creator.nickname}</div>
                </div>
              </div>

            {/* ëª¨ì„ ì¼ì • */}
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <CalendarIcon className="w-5 h-5 mr-2" />
                ëª¨ì„ ì¼ì •
              </h3>
              <div className="space-y-3 text-sm">
                <div className="flex items-center text-gray-600">
                  <ClockIcon className="w-4 h-4 mr-2 flex-shrink-0" />
                  <span>
                    {group.startDateTime ?
                      new Date(group.startDateTime).toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'short'
                      }) + ' ' + new Date(group.startDateTime).toLocaleTimeString('ko-KR', {
                        hour: '2-digit',
                        minute: '2-digit'
                      })
                      : 'ì¼ì • ë¯¸ì •'
                    }
                  </span>
                </div>
                <div className="flex items-center text-gray-600">
                  <span className="w-4 h-4 mr-2 text-center flex-shrink-0">
                    {group.meetingType === "ONLINE" ? "ğŸ”—" : "ğŸ“"}
                  </span>
                  {group.meetingType === "ONLINE" ? (
                      <a
                          href={group.meetingUrl}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="underline text-blue-600 break-all"
                      >
                        {group.meetingUrl}
                      </a>
                  ) : (
                      <span>{group.location}</span>
                  )}
                </div>
                <div className="flex items-center text-gray-600">
                  <span className="w-4 h-4 mr-2 text-center flex-shrink-0">â±ï¸</span>
                  <span>ì•½ {group.durationHours}ì‹œê°„ ì˜ˆì •</span>
                </div>
                <div className="pt-2">
                  <span className={`inline-block px-2 py-1 rounded-full text-xs font-medium ${
                      group.hasAssignment
                          ? 'bg-blue-100 text-blue-800' 
                      : 'bg-gray-100 text-gray-800'
                  }`}>
                    {group.hasAssignment ? 'ê³¼ì œ ìˆìŒ' : 'ììœ  ì°¸ì—¬'}
                  </span>
                </div>
              </div>
            </div>
            {/* ì•¡ì…˜ ë²„íŠ¼ */}
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">ë©”ë‰´</h3>
              <div className="space-y-2">
                <Link
                    to={`/reading-groups/${group.id}/members`}
                    className="w-full btn btn-outline flex items-center justify-center"
                >
                  <UserPlusIcon className="w-4 h-4 mr-2" />
                  ë©¤ë²„ ê´€ë¦¬
                </Link>

                {isCreator ? (
                    <button
                        onClick={handleDeleteGroup}
                        className="w-full btn btn-outline text-red-600 border-red-300 hover:bg-red-50 flex items-center justify-center"
                    >
                      <TrashIcon className="w-4 h-4 mr-2" />
                      ëª¨ì„ ì‚­ì œ
                    </button>
                ) : (
                    <button
                        onClick={handleLeaveGroup}
                        className="w-full btn btn-outline text-red-600 border-red-300 hover:bg-red-50"
                    >
                      ëª¨ì„ íƒˆí‡´
                    </button>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ReadingGroupDetail;
